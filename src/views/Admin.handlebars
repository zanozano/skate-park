<div>

  <div class="py-4">
    <h2>Administración</h2>
    <hr class="w-50" />

    <table class="table w-50 m-auto">
      <thead>
        <tr>
          <th scope="col">#</th>
          <th scope="col">Foto</th>
          <th scope="col">Nombre</th>
          <th scope="col">Años de experiencia</th>
          <th scope="col">Especialidad</th>
          <th scope="col">Estado</th>
        </tr>
      </thead>
      <tbody id='cuerpo'>
        {{#each usuarios}}
        <tr>
          <td>{{@index}}</td>
          <td><img src='/uploads/{{this.foto}}' style='width:100px;'></td>
          <td>{{this.nombre}}</td>
          <td>{{this.anos_experiencia}}</td>
          <td>{{this.especialidad}}</td>
          <td><input type='checkbox' {{#if this.estado}} checked {{/if}} onclick='changeStatus({{this.id}},this)'></td>
        </tr>
        {{/each}}
      </tbody>
    </table>
  </div>
</div>

<script>
  const changeStatus = async (id, e) => {
    const estado = e.checked;

    try {
      const response = await axios.put('http://localhost:3000/approve_user', {
        id,
        estado,
      });

      Swal.fire({
        icon: estado ? 'success' : 'warning',
        title: estado ? '¡Éxito!' : 'Warning',
        text: estado ? 'Perfil de usuario aprobado' : 'Perfil de usuario en revisión',
      });
    } catch (error) {
      if (error.response) {
        const { data } = error.response;
        const { error: errorMessage } = data;
        Swal.fire({
          icon: 'error',
          title: 'Error',
          text: errorMessage,
        });
      } else if (error.request) {
        Swal.fire({
          icon: 'warning',
          title: 'Advertencia',
          text: 'No se recibió respuesta del servidor.',
        });
      } else {
        Swal.fire({
          icon: 'error',
          title: 'Error',
          text: 'Ocurrió un error al realizar la solicitud.',
        });
      }
    }
  };
</script>
